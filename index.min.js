/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2023 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceXML={}))}(this,(function(e){"use strict";var r=function(e,r){return-1!==r.indexOf(e)},t=function(e){return Array.isArray(e)},i=function(e,r){return e&&n(r)&&e instanceof r},n=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},c=function(e){return e.length},f=function(e,r){return e=e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),r&&(e=e.replace(/'/g,"&apos;").replace(/"/g,"&quot;")),e},s=function e(r){if(t(r))return r.map((function(t){return e(r)}));if(function(e,r){return void 0===r&&(r=!0),"object"==typeof e&&(!r||i(e,Object))}(r)){for(var n in r)r[n]=e(r[n]);return r}return!1===r?"false":null===r?"null":!0===r?"true":""+r},u=window,o=function(e,r){return function(e){return i(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,n(r)?r:"g"))},a="!$^*()+=[]{}|:<>,.?/-",l="[\\w:.-]+",d=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"},p=function(e){return"</("+e+")>"},v="(?:\x3c!--([\\s\\S](?!--\x3e)*)--\x3e|<!((?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^>'\"])*)>|"+p(l)+"|<\\?((?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^>'\"])*)\\?>|"+("<("+l+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?/?>|")+d(l)+")",x={};function $(e){if(!e)return"";e=function(e){return Object.keys(e)}(e).sort().reduce((function(r,t){return r[t]=e[t],r}),{});var r,t,i="";for(r in e)!1!==(t=e[r])&&null!==t&&(i+=" "+r,!0!==t&&(i+='="'+f(s(t),!0)+'"'));return i}function b(e){return!1!==e&&(!function(e){return"string"==typeof e}(e)?t(e)||(e=["",""]):e=[e,e],n(e[1])||(e[1]=e[0])),e}x.insert=function(e,r,t,i){void 0===r&&(r=""),void 0===t&&(t={}),void 0===i&&(i=!1);return!1!==(i=b(i))&&this.trim(i[0],""),this.insert("<"+e+$(t)+(!1!==r?">"+r+"</"+e+">":" />")+(!1!==i?i[1]:""),-1,!0)},x.toggle=function(e,r,t,i){void 0===r&&(r=""),void 0===t&&(t={}),void 0===i&&(i=!1);var n=this,c=n.$(),f=c.after,s=c.before,u=c.value,a=d(e),l=p(e),v=o(a+"$",""),x=o("^"+l,""),g=v.test(s),m=x.test(f);return m&&g?n.replace(x,"",1).replace(v,"",-1):(v=o("^"+a,""),x=o(l+"$",""),g=v.test(u),(m=x.test(u))&&g&&n.insert(u=u.replace(x,"").replace(v,"")),!u&&r&&n.insert(r),!1!==(i=b(i))&&n.trim(i[0],i[1]),n.wrap("<"+e+$(t)+">","</"+e+">"))},x.wrap=function(e,r,t,i){void 0===r&&(r=""),void 0===t&&(t={}),void 0===i&&(i=!1);var n=this,c=n.$();return c.after,c.before,!c.value&&r&&n.insert(r),!1!==(i=b(i))&&n.trim(i[0],i[1]),n.wrap("<"+e+$(t)+">","</"+e+">")};var g={source:{type:"XML"}};e.canKeyDown=function(e,r){var t,i,n=r.state,f=n.source.tab||n.tab||"\t",s=e.key,u=e.queue,x=e+"";if(u.Alt||u.Control)return!0;if(["-",">","/","?"," "].includes(s)){var $=r.$(),b=$.after,g=$.before,m=$.value,w=$.start;if("-"===s&&!m&&"<!-"===g.slice(-3))return r.wrap("- "," --"+(">"===b[0]?"":">")).record(),!1;if(">"===s||"/"===s){var h=o(d(l)+"$","").exec(g+">");if(!m&&h)return"/"===s?">"===b[0]?(r.trim("",!1).insert(" /",-1).select(r.$().start+1).record(),!1):(r.trim("",!1).insert(" />",-1).record(),!1):(b.startsWith("></"+h[1]+">")?r.select(w+1).record():b.startsWith("</"+h[1]+">")?r.insert(">",-1).record():r.wrap(">","</"+h[1]+(">"===b[0]?"":">")).record(),!1)}if("?"===s&&!m&&"<"===g.slice(-1))return r.wrap("?","?"+(">"===b[0]?"":">")).record(),!1;if(" "===x&&!m&&("--\x3e"===b.slice(0,3)&&"\x3c!--"===g.slice(-4)||"?>"===b.slice(0,2)&&"<?"===g.slice(0,2)&&/<\?\S*$/.test(g)))return r.wrap(" "," ").record(),!1}if("ArrowLeft"===x){var y=r.$(),k=y.before,S=y.start;if(!y.value){var j=o(v+"$","").exec(k);if(j)return r.select(S-c(j[0]),S),!1}}if("ArrowRight"===x){var A=r.$(),E=A.after,T=A.start;if(!A.value){var M=o("^"+v,"").exec(E);if(M)return r.select(T,T+c(M[0])),!1}}if("Enter"===x){var O=r.$(),W=O.after,q=O.before,D=O.value,L=q.split("\n").pop().match(/^(\s+)/),R=L&&L[1]||"",C=q.match(o(d(l)+"$",""));if(!D){if(/^[ \t]*-->/.test(W)&&/<!--[ \t]*$/.test(q)||/^[ \t]*\?>/.test(W)&&/<\?\S*[ \t]*$/.test(q))return r.trim().wrap("\n"+R,"\n"+R).record(),!1;if(C)return W.startsWith("</"+C[1]+">")?r.record().trim().wrap("\n"+R+f,"\n"+R).record():r.record().wrap("\n"+R+f,"\n"+R+"</"+C[1]+">").record(),!1}}if("Backspace"===x){var X=r.$(),_=X.after,B=X.before;if(!X.value){if("\x3c!--"===B.slice(-4))return r.replace(/<!--$/,"",-1),"--\x3e"===_.slice(0,3)&&r.replace(/^-->/,"",1),r.record(),!1;if(/^\s+-->/.test(_)&&/<!--\s+$/.test(B))return r.trim(" "===B.slice(-1)?"":" "," "===_[0]?"":" ").record(),!1;if(/<\?\S*$/.test(B))return r.replace(/<\?\S*$/,"",-1),"?>"===_.slice(0,2)&&r.replace(/^\?>/,"",1),r.record(),!1;if(/^\s+\?>/.test(_)&&/<\?\S*\s+$/.test(B))return r.trim(" "===B.slice(-1)?"":" "," "===_[0]?"":" ").record(),!1;var K=o(v+"$",""),P=K.exec(B);if(P){if(" />"===B.slice(-3))return r.replace(/ \/>$/,"/>",-1).record(),!1;if("/>"===B.slice(-2))return r.replace(/\/>$/,">",-1).record(),!1;r.replace(K,"",-1);var z=P[0].slice(1).split(/\s+|>/)[0];return P[0]&&"/"!==P[0][1]&&_.startsWith("</"+z+">")&&r.replace(o("^</"+z+">",""),"",1),r.record(),!1}if(o(d(l)+"\\n(?:"+(t=f,void 0===i&&(i=""),t.replace(o("["+i+a.replace(/./g,"\\$&")+"]"),"\\$&")+")?$"),"").test(B)&&o("^\\s*"+p(l),"").test(_))return r.trim().record(),!1}}if("Delete"===x){var F=r.$(),G=F.after;if(!F.value){if("--\x3e"===G.slice(0,3))return r.replace(/^-->/,"",1).record(),!1;if("?>"===G.slice(0,2))return r.replace(/^\?>/,"",1).record(),!1;var H=o("^"+v,"");if(H.exec(G))return r.replace(H,"",1).record(),!1}}return!0},e.canMouseDown=function(e,t){return e.key,e.queue.Control||u.setTimeout((function(){var e=t.$(),i=e.after,n=e.end,f=e.before,s=e.value;if(!s)for(var u,a,d="\ufeff",p=v.split("("+l+")").join("((?:[\\w:.-]+|\ufeff)+)"),x=o(p),$=f+s+d+i;u=x.exec($);)if(r(d,u[0])){var b=u[0].split(d);if(">"===b[1]||"/>"===(b[1]||"").trim()){t.select(a=u.index,a+c(u[0])-1);break}if("<"!==b[0]&&"</"!==b[0]&&!/\s/.test(b[0])){t.select(a=u.index+("/"===b[0][1]?2:1),n+c(b[1].split(/[\s\/>]/).shift()));break}var g=void 0;if(g=o("=(\"[^\"]*\ufeff[^\"]*\"|'[^']*\ufeff[^']*')").exec(u[0])){t.select(a=u.index+g.index+2,a+c(g[1])-3);break}if(g=o("=([^\"'\\s\\/>]*\ufeff[^\"'\\s\\/>]*)").exec(u[0])){t.select(a=u.index+g.index+1,a+c(g[1])-1);break}if("<"!==b[0]&&"</"!==b[0]&&(g=o("([^=\"'\\s]*\ufeff[^=\"'\\s]*)[=\\s\\/>]").exec(u[0]))){t.select(a=u.index+g.index,a+c(g[1])-1);break}t.select(a=u.index,a+c(u[0])-1);break}}),1),!0},e.state=g,e.that=x,e.toAttributes=$,Object.defineProperty(e,"__esModule",{value:!0})}));